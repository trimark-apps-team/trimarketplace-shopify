<div class="message-slider-section-wrapper page-width">
<section class="message-slider" id="{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="message-slider__wrapper">
    <div class="message-slider__slides">
      {% for block in section.blocks %}
        <div class="message-slide">
          {% if block.settings.title != blank %}
            <h3 class="message-slide__title">
              {{ block.settings.title }}
            </h3>
          {% endif %}
          {% if block.settings.content != blank %}
            <div class="message-slide__content">{{ block.settings.content }}</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <div class="message-slider__controls">
      <button class="slider-arrow prev" aria-label="Previous slide">&#10094;</button>
      <div class="slider-dots">
        {% for block in section.blocks %}
          <span class="slider-dot{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}"></span>
        {% endfor %}
      </div>
      <button class="slider-arrow next" aria-label="Next slide">&#10095;</button>
    </div>

    <button type="button" class="message-slider__hide">X</button>
  </div>
</section>
</div>
<style>
    .message-slider {
      background: #fff;
      padding: 1rem;
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      max-width: 100%;
      margin: auto;
    }
    .message-slider__slides {
      display: flex;
      transition: transform 0.3s ease;
      will-change: transform;
    }
    .message-slide {
      flex: 0 0 100%;
      box-sizing: border-box;
    }
    .message-slide__title {
      font-weight: bold;
      margin: 0;
    }
    .message-slide__content {
      margin: 0.5rem 0;
    }
    .message-slider__controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 0.5rem;
    }
    .slider-dots {
      display: flex;
      gap: 6px;
    }
    .slider-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #ccc;
      border-radius: 50%;
      cursor: pointer;
    }
    .slider-dot.active {
      background: #b11830;
    }
    .slider-arrow {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #333;
      padding: 4px;
    }
    .slider-arrow:hover {
      color: #b11830;
    }
    .message-slider__hide {
      position: absolute;
      right: 10px;
      top: 10px;
      background: none;
      border: none;
      color: #333;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #{{ section.id }} .message-slide .message-slide__title{
      color: {{ section.settings.header_color }};
      font-size: {{ section.settings.header_font_size }}px;
    }
    #{{ section.id }} .message-slide .message-slide__content{
      color: {{ section.settings.text_color }};
      font-size: {{ section.settings.text_font_size }}px;
      width: 99%;
    }
    #{{ section.id }} .message-slider__wrapper {
      margin-top: 20px;
      margin-bottom: 20px;
    }
    .message-slider-section-wrapper {
      margin-top: {{ section.settings.margin_top }}px;
      margin-bottom: {{ section.settings.margin_bottom }}px;
      width: 100%;
    }
    @media screen and (max-width: 749px) {
      #{{ section.id }} .message-slide .message-slide__title{
        color: {{ section.settings.header_color_mobile }};
        font-size: {{ section.settings.header_font_size_mobile }}px;
      }
      #{{ section.id }} .message-slide .message-slide__content{
        color: {{ section.settings.text_color_mobile }};
        font-size: {{ section.settings.text_font_size_mobile }}px;
      }
      #{{ section.id }} .message-slider__hide {
        display:none;
      }
      .message-slider-section-wrapper {
        margin-top: {{ section.settings.margin_top_mobile }}px;
        margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
      }
    }

    @media screen and (max-width: 480px) {
      .message-slide {
        max-width: 100%;
        overflow-wrap: break-word;
        word-break: break-word;
      }

      #{{ section.id }} .message-slide .message-slide__content {
        max-width: 100%;
        width: auto;
      }

      .message-slider__slides {
        width: 100%;
      }

      .message-slider__controls {
        flex-wrap: wrap;
        gap: 6px;
      }
    }

  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const section = document.querySelector('[data-section-id="{{ section.id }}"]');
      const slidesWrapper = section.querySelector('.message-slider__slides');
      const dots = section.querySelectorAll('.slider-dot');
      const prevBtn = section.querySelector('.slider-arrow.prev');
      const nextBtn = section.querySelector('.slider-arrow.next');
      const hideBtn = section.querySelector('.message-slider__hide');
      const totalSlides = dots.length;
      let index = 0;
      let startX = 0;
      let currentX = 0;
      let isDragging = false;

      function updateSliderPosition() {
        slidesWrapper.style.transform = `translateX(-${index * 100}%)`;
        dots.forEach(d => d.classList.remove('active'));
        dots[index].classList.add('active');
      }

      dots.forEach(dot => {
        dot.addEventListener('click', function() {
          index = parseInt(this.dataset.index);
          updateSliderPosition();
        });
      });

      prevBtn.addEventListener('click', function() {
        index = index > 0 ? index - 1 : totalSlides - 1;
        updateSliderPosition();
      });

      nextBtn.addEventListener('click', function() {
        index = (index + 1) % totalSlides;
        updateSliderPosition();
      });

      hideBtn.addEventListener('click', function() {
        section.style.display = 'none';
      });

      // Drag / Swipe
      slidesWrapper.addEventListener('mousedown', startDrag);
      slidesWrapper.addEventListener('touchstart', startDrag);

      slidesWrapper.addEventListener('mousemove', dragMove);
      slidesWrapper.addEventListener('touchmove', dragMove);

      slidesWrapper.addEventListener('mouseup', endDrag);
      slidesWrapper.addEventListener('mouseleave', endDrag);
      slidesWrapper.addEventListener('touchend', endDrag);

      function startDrag(e) {
        isDragging = true;
        startX = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
        slidesWrapper.style.transition = 'none';
      }

      function dragMove(e) {
        if (!isDragging) return;
        currentX = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
        const deltaX = currentX - startX;
        slidesWrapper.style.transform = `translateX(${-index * 100 + (deltaX / section.offsetWidth) * 100}%)`;
      }

      function endDrag(e) {
        if (!isDragging) return;
        isDragging = false;
        const deltaX = (currentX || startX) - startX;
        if (deltaX > 50 && index > 0) {
          index--;
        } else if (deltaX < -50 && index < totalSlides - 1) {
          index++;
        }
        slidesWrapper.style.transition = 'transform 0.3s ease';
        updateSliderPosition();
        startX = 0;
        currentX = 0;
      }

      // Auto-slide
      setInterval(() => {
        index = (index + 1) % totalSlides;
        updateSliderPosition();
      }, 5000);
    });
  </script>
{% schema %}
{
  "name": "Message Slider",
  "settings": [
        { "type": "color", "id": "header_color", "label": "Header Color", "default": "#b11830" },
        { "type": "range", "id": "header_font_size", "label": "Header Font Size", "default": 18, "min": 12, "max": 100, "step": 1, "unit": "px" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#b11830" },
        { "type": "range", "id": "text_font_size", "label": "Text Font Size", "default": 18, "min": 12, "max": 100, "step": 1, "unit": "px" },
        { "type": "range", "id": "margin_top", "label": "Top Gap", "default": 18, "min": 0, "max": 100, "step": 1, "unit": "px" },
        { "type": "range", "id": "margin_bottom", "label": "Bottom Gap", "default": 18, "min": 0, "max": 100, "step": 1, "unit": "px" },
        { "type": "header", "content": "Mobile Settings" },
        { "type": "color", "id": "header_color_mobile", "label": "Header Color Mobile", "default": "#b11830" },
        { "type": "range", "id": "header_font_size_mobile", "label": "Header Font Size Mobile", "default": 18, "min": 12, "max": 100, "step": 1, "unit": "px" },
        { "type": "color", "id": "text_color_mobile", "label": "Text Color Mobile", "default": "#b11830" },
        { "type": "range", "id": "text_font_size_mobile", "label": "Text Font Size Mobile", "default": 18, "min": 12, "max": 100, "step": 1, "unit": "px" },
        { "type": "range", "id": "margin_top_mobile", "label": "Top Gap Mobile", "default": 18, "min": 0, "max": 100, "step": 1, "unit": "px" },
        { "type": "range", "id": "margin_bottom_mobile", "label": "Bottom Gap Mobile", "default": 18, "min": 0, "max": 100, "step": 1, "unit": "px" },
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "richtext", "id": "content", "label": "Content" }
      ]
    }
  ],
  "max_blocks": 5,
  "presets": [
    {
      "name": "Message Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}