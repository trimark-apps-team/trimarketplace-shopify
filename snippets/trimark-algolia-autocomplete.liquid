<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic@VERSION/dist/theme.min.css">



<script defer>
  document.addEventListener('DOMContentLoaded', function () {
    const { algoliasearch, autocomplete, getAlgoliaResults } = algoliaShopify.externals;

    const searchClient =
      algoliaShopify.searchClient ||
      algoliaShopify.externals.algoliasearch(
        algoliaShopify.config.app_id,
        algoliaShopify.config.search_api_key
      );

    const indexName = `${algoliaShopify.config.index_prefix}products`;

    autocomplete({
      container: '#autocomplete-container',
      placeholder: 'Search products...',
      openOnFocus: false,

      getSources({ query }) {
        return [
          {
            sourceId: 'products',
            getItems() {
              return getAlgoliaResults({
                searchClient,
                queries: [
                  {
                    indexName,
                    params: { query, hitsPerPage: 6 },
                  },
                ],
              });
            },

            templates: {
              header({ html }) {
                if (!query) return null;
                return html`<div class="aa-SourceHeader">
                  <span class="aa-SourceHeaderTitle">Products for "${query}"</span>
                  <div class="aa-SourceHeaderLine"></div>
                </div>`;
              },
              item({ item, components, html }) {
                const productUrl = item.url || `/products/${item.handle}`;
                const variantId = item.objectID?.split('_').pop();
                const price = item.price ;
                const title = item.title;
                const uom = item.meta.custom['3_uom'] || '';
                
                return html`
                <div class="aa-ItemWrapper">
                  <a href="${productUrl}" class="aa-ItemLink">
                    <div class="aa-ItemContent">
                      <div class="aa-ItemPicture aa-ItemPicture--loaded">
                        <img
                          src="${item.image || item.image_url}"
                          alt="${item.title}"
                        />
                      </div>

                      <div class="aa-ItemContentBody">
                         ${uom ? `<div class="aa-ItemContentUOM">UOM: ${uom}</div>` : ''}
                          <div class="aa-ItemContentTitle">
                            ${components.Highlight({
                              hit: item,
                              attribute: 'title',
                            })}
                          </div>
                       

                        <div class="aa-ItemContentVendor">
                          ${components.Highlight({
                            hit: item,
                            attribute: 'vendor',
                          })}
                        </div>

                        <div class="aa-ItemContentPrice">
                          ${price ? `$${price}` : ''}
                          ${uom ? `<span class="aa-ItemUOM"> / ${uom}</span>` : ''}
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
                `;
              },

              noResults() {
                return 'No results found';
              },
            },
          },
        ];
      },
    });
  });
</script>
