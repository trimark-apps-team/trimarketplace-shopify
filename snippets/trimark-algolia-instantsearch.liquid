<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/instantsearch.css@8.5.1/themes/reset-min.css"
  integrity="sha256-KvFgFCzgqSErAPu6y9gz/AhZAvzK48VJASu3DpNLCEQ="
  crossorigin="anonymous"
/>
<link
  rel="stylesheet"
  href="{{ 'trimark-algolia-instantsearch-overrides.css' | asset_url }}"
>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
  if (!window.algoliaShopify) {
    console.error('Algolia not initialized â€” make sure the hidden InstantSearch block is included.');
    return;
  }

  const { algoliasearch, instantsearch } = algoliaShopify.externals;

  const searchClient =
    algoliaShopify.searchClient ||
    algoliasearch(
      algoliaShopify.config.app_id,
      algoliaShopify.config.search_api_key
    );

  const indexName = `${algoliaShopify.config.index_prefix}products`;

  const search = instantsearch({
    indexName,
    searchClient,
  });

  // ðŸ§© Direct demo-style widget calls
  search.addWidgets([
    instantsearch.widgets.searchBox({
      container: '#searchbox',
      placeholder: 'Search products...',
    }),

    instantsearch.widgets.clearRefinements({
      container: '#clear-refinements',
    }),

    instantsearch.widgets.refinementList({
      container: '#brand-list',
      attribute: 'brand',
    }),

    instantsearch.widgets.hits({
      container: '#hits',
      templates: {
        item(hit) {
          return `
            <a href="/products/${hit.handle}">
              <img src="${hit.image || hit.image_url}" alt="${hit.title}" width="150" />
              <h3>${instantsearch.highlight({ attribute: 'title', hit })}</h3>
              <p>${hit.price}</p>
            </a>
          `;
        },
      },
    }),

    instantsearch.widgets.pagination({
      container: '#pagination',
    }),

    instantsearch.widgets.configure({
      hitsPerPage: 8,
    }),
  ]);

  search.start();
});
</script>