<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@8.5.1/themes/reset-min.css" integrity="sha256-KvFgFCzgqSErAPu6y9gz/AhZAvzK48VJASu3DpNLCEQ=" crossorigin="anonymous">
<link
  rel="stylesheet"
  href="{{ 'trimark-algolia-instantsearch-overrides.css' | asset_url }}"
>
<script defer>
document.addEventListener('DOMContentLoaded', () => {

  const { algoliasearch, instantsearch, widgets } = algoliaShopify.externals;

  // Destructure widgets from the top-level `widgets` object (not instantsearch.widgets)
  const {
    searchBox,
    hits,
    pagination,
    refinementList,
    clearRefinements,
    configure,
    rangeInput
  } = widgets;

  const searchClient =
    algoliaShopify.searchClient ||
    algoliasearch(
      algoliaShopify.config.app_id,
      algoliaShopify.config.search_api_key
    );

  const indexName = `${algoliaShopify.config.index_prefix}products`;

  const search = instantsearch({
    indexName,
    searchClient,
  });

  // ✅ Don't use instantsearch.widgets.* — use the destructured widget functions directly.
  search.addWidgets([
    searchBox({
      container: '#searchbox',
      placeholder: 'Search products...',
    }),

    clearRefinements({
      container: '#clear-refinements',
    }),

    refinementList({
      container: '#brand-list',
      attribute: 'vendor',
    }),
    widgets.sortBy({
  container: '#sort-by',
  items: [
    { label: 'Relevance', value: `${indexName}` },
    { label: 'Price (asc)', value: `${indexName}_price_asc` },
    { label: 'Price (desc)', value: `${indexName}_price_desc` },
  ],
}),
widgets.menu({
  container: '#price-range',
  attribute: 'price',
  items: [
    { label: '$0 – $10', start: 0, end: 10 },
    { label: '$10 – $25', start: 10, end: 25 },
    { label: '$25 – $50', start: 25, end: 50 },
    { label: '$50 – $75', start: 50, end: 75 },
    { label: '$75 – $100', start: 75, end: 100 },
    { label: '$100 – $200', start: 100, end: 200 },
    { label: '$200 – $500', start: 200, end: 500 },
    { label: '$500 – $1000', start: 500, end: 1000 },
    { label: '$1000+', start: 1000 },
  ],
  limit: 5, // how many to show before “see more”
  showMore: true,
  showMoreLimit: 10,
}),
widgets.rangeSlider({
  container: '#price-slider',
  attribute: 'price',
}), 
widgets.stats({
  container: '#search-stats',
}),
    hits({
      container: '#hits',
      templates: {
        item(hit) {
          return `
            <a href="/products/${hit.handle}">
              <img src="${hit.image || hit.image_url}" alt="${hit.title}" width="150" />
              <h3>${instantsearch.highlight({ attribute: 'title', hit })}</h3>
              <p>${hit.price}</p>
            </a>
          `;
        },
      },
    }),

    pagination({
      container: '#pagination',
    }),

    configure({
      hitsPerPage: 8,
    }),
  ]);

  search.start();
});
</script>